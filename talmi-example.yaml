audit:
  enabled: true
  path: talmi-audit.jsonl
  type: jsonl

issuers:
  # use static issuer for testing
  - name: test-static-issuer
    type: static
    token_map:
      "this-is-a-super-secret-token": # when this token is presented, return a principal with the following claims:
        repository: my-org/my-repo

  - name: cam-oidc-dev-staging
    type: oidc
    issuer_url: "https://idp.acme.come"
    client_id: "talmi-sts"

providers:
  - name: talmi
    type: talmi-jwt # issue Talmi JWTs for CLI usage

  - name: stub
    type: stub # grant `stub` token to log and return dummy token

  - name: my-github-org
    type: github-app
    app_id: 1126
    private_key_path: "./talmi-dev-token-adapter.pem"
    server: "https://github.acme.com/api/v3/" # for enterprise server

rules:
  - name: allow-specific-to-create-talmi-jwt
    description: Allow specific people to get an admin Talmi JWT
    match:
      issuer: cam-oidc-dev-staging
      condition:
        sub:
          in:
            - "admin-1@acme.com"
            - "admin-2@acme.com"
    grant:
      provider: talmi
      config:
        roles: [ "audit", "admin" ]

  - name: allow-@acme-to-create-talmi-jwt
    description: Allow @acme.com to get a read-only Talmi JWT
    match:
      issuer: cam-oidc-dev-staging
      condition:
        sub: { contains: "@acme.com" }
    grant:
      provider: talmi
      config:
        roles: [ "audit" ]

  - name: allow-static-to-access-github
    description: "Allow test static issuer access GitHub repo"
    match:
      issuer: test-static-issuer
      condition:
        repository: "my-org/my-repo"
    grant:
      provider: my-github-org
      permissions:
        contents: "write"
      config:
        owner: my-github-org-name
        repositories:
          - super-secret-repository

